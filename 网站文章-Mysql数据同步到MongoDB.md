###### 背景：由于业务需要，我们想让一部分实时性没那么高要求的业务数据从MySQL移动到MongoDB里，提高客户端读速度，然后把这个MySQL表分表，保留少部分数据，提高它的写速度

我们使用的是阿里云MongoDB3.4，php mongodb扩展(不是mongo)，MongoDB PHP Driver

那么后续需要做三部分工作：

* MySQL里已有一千四百万多万数据的移动

* 后续新增数据的同步问题

* 相关业务数据代码的修改

###### 那么，下面来说说我碰到的问题

1. 已有数据的迁移，不能直接用`limit` `offset`的方式，虽然只有一千四百万多万，但到后面这样依然会很慢，应该使用id分割，查询固定条数的数据，批量移入MongoDB;

2. 以守护进程的方式读从库，循环从上次同步的id开始读取，但是这里也有一个问题，就是主从同步问题导致的守护进程同步漏数据;

3. 修改业务数据，导致MongoDB连接数超载，服务相继出现问题;

4. 使用swoole实现MongoDB连接池问题.
